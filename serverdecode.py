from rostoclientencprovider import RosToClientEncProvider

# Just a test script that can be used to check if the encryption/decryption is correct. It also checks
# if the SHA1 is valid.

# To use it, you can get a hex stream from the server response in Wireshark and use decrypt function.
# Or you can use the actual XML with encrypt function to get an encrypted reply that looks like a reply from the server.
# By default it uses platfrom key from PS3, you can change it in encprovider.py.

message = bytearray.fromhex("8a215fee22b5cdcdf220a2b23254d2be4466ba57243295fda97c0947a54aa98fa9e2029b1bb39d78a483b579e1ad2e4bbefc5ce22bf7c0ff19c78a8f2f71836c7e062c3af3c2005da0f8f288f832c76b0685aff30dc22878f00b9ae7d739fc4f8dcc103d2534f1b0c375bfdcbb53ee283254c61fd0731c93a6554f117c8ef80962d4a8b5bcc56555a5a3ef4639cd7be590bcb7cc6e6d300cec306f6fdd6b4c4e355c0a645e7c0d584fd67ce9f9d187d542776a5c83f47a5b6d08cd21f39f9290531ee9e94c7491f3279f6f8b6f9efe8256a7ee004d314c41ea9fce7fd8790dc86175abca17a5e75fb4886fde70a3bc26c036f3f10634c308c19317329fa118e89fded495d79fa4e95bbb491f9c74ae73d17621f1bc645240614898effc3e006d575e7116a36a747d065d3b6a5f386cafaeddabeafcb68b61cec5a2dea5a0b2732e5527cff16146e0b636de64bd116aa22a587254c5e49292a5dc599c5404d6e467acf2b618fc41c05e7703593e9c0efdaaf3135baa09940ec9655c147a5321613ec9ce9e7358c2ffd2b0e9126cc2b6e28a361eb8f61abf2cc50a1123fbbc8570db24ec9a9480bba81fb544c770d744020fe7b38578e6af229f77ea30541e80a5c8f0cf861c18d4ddaa4cf36373e24b6af50b3ba7a9a8bba2208d641ba91aca3c0ea2cb4995839f75deedeeac9a5b3f6a1a6d702cec0cd20c21d43347ec62a401581ba05993fad57b771b342ec31bc90dbad373905888f6eafe1614c5503cd4df87574e7fc3af06ec560df4ac32c77345fa7cee1835446c17378d9fb9d18a3af3bdf35c1af48d16643084204c5b7b51f3acb9e0376646e983c69e6fd9450439021a16491fe54c894600c4349c50d6f93c3f9f65840fc9ff1c0c50ddc74bcea0d451676d392cd86cb7a8d3aa9e4f7e6f2aad68dc6e790c5d7856a8ef16f9587f0a46cd5a8082491c75083d16d7554e2c1c0594e30136d3f984f6a05ebcafc3d0ccad5b572758ee035512c950f9f26dad18912ad72893ca1f57f162bbf489c91f16e25fc8052069984a2494d93229b676af725c2ed6e1eef85989b334a7c753ba737a13c9fe730f24e62cd11f59a7744ef75cfc85694b62a3a6fff49963cfe5bea982d938eee78e964e50f6467708887b4235b1540a73196b154c70ee383d7ec301c2637912b770e791f86df2bfe304e17a8b45d538ccfaab179542fde0dbb0f4d40b246a5bd6c14e1dd5725adb9e5de044ab0eb64cf4597972622fb276fdcc1e7cc664a899f30fefba4a5780eee855a19272137382b21fe3db2f5223ca958a96cfd90ef11418ca4578a512e3559418cb04d3320a436fffaae7dcfa26a5e9c4540a57cf68ea65fdcfb820725674f56b3f5096e124258a60e4cc1b1b0c7ad284ce1d848e9a2ee40758e732189bc43fc43626be6dfb948e5b6afb3accbddc7af86a93c9f0066b44f87ac6b0fac29903902bc7c90cc136db8c2eb91d0cba46d8f00da1fa20f98652c72d989517a8e3f4c3d4fef1f80c1552f823596c7b766a2337f956e34c5f9671134f0c3040a3047531b17860e34c041ab5be7649b074008e29fa108b14f571cdf15ab9956c858c29ce7d7d65408e2a2fb62d9fe4ddcf7b336b5ae0f73568a6dbc892f078ab82717ad30e2e2fc74986bc2ad20e844c32d5e373")
#message = '<?xml version="1.0" encoding="utf-8"?>\r\n<Response xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" ms="0" xmlns="CreateTicketResponse">\r\n  <Status>0</Status>\r\n  <Error Code="NotAvailable" />\r\n</Response>'

body = RosToClientEncProvider().decrypt(message)
#body = RosToClientEncProvider().encrypt(message)

#print(body)
